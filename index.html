<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‹¼å­—å­¸ç¿’æ©Ÿ V4.4 (å®Œæ•´ä¿®å¾©ç‰ˆ)</title>
    
    <style>
        :root {
            --primary: #FFD54F; --primary-dark: #FFC107; --secondary: #4FC3F7;
            --accent: #FF7043; --bg: #FFF9C4; --text: #37474F;
            --vowel: #E53935; --consonant: #1565C0; --success: #66BB6A; --error: #EF5350;
            --sent-bg: #E0F7FA; --sent-text: #006064; --sent-hover: #B2EBF2;
            --hint-bg: #F3E5F5; --hint-text: #7B1FA2;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .noselect { -webkit-user-select: none; user-select: none; }

        header {
            width: 100%; background: var(--primary); padding: 10px 15px;
            text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header-title { font-size: 1.2rem; font-weight: bold; color: #5D4037; flex-grow: 1; }
        .setting-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }

        .controls-row { display: flex; justify-content: center; gap: 10px; width:100%; padding: 10px; background: #fff8e1;}
        select { padding: 8px; border-radius: 20px; border: 2px solid #ddd; font-size: 1rem; background: white; }

        .tabs { display: flex; width: 95%; max-width: 600px; margin: 10px auto; background: rgba(255,255,255,0.7); border-radius: 30px; padding: 5px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-weight: bold; font-size: 1rem; border-radius: 25px; color: #90A4AE; }
        .tab-btn.active { background: var(--secondary); color: white; box-shadow: 0 3px 6px rgba(3, 155, 229, 0.3); }

        #game-area {
            width: 95%; max-width: 600px; background: white; border-radius: 25px; padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08); text-align: center; margin-bottom: 20px;
            min-height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }

        .big-word { font-size: 3rem; font-weight: bold; margin: 15px 0; letter-spacing: 1px; line-height: 1.2; cursor: pointer; }
        .big-word:active { transform: scale(0.95); }
        .vowel { color: var(--vowel); } .consonant { color: var(--consonant); }
        .syllable-display { font-size: 1.5rem; color: #90A4AE; margin-bottom: 5px; height: 30px; font-family: monospace; }
        
        .letter-slots { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; margin: 20px 0; min-height: 60px; }
        .slot { width: 40px; height: 45px; border-bottom: 4px solid #E0E0E0; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; }
        .slot.filled { border-bottom-color: var(--secondary); transform: translateY(-2px); }
        .slot.space { border-bottom: none; width: 15px; }
        
        .scramble-area { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 10px; }
        .block-btn { width: 50px; height: 50px; background: var(--primary); border: none; border-radius: 12px; font-size: 1.6rem; font-weight: bold; box-shadow: 0 4px 0 var(--primary-dark); cursor: pointer; }
        .block-btn:active { transform: translateY(4px); box-shadow: none; }
        .block-btn:disabled { opacity: 0; pointer-events: none; }
        
        .input-box { font-size: 1.8rem; padding: 10px; width: 90%; text-align: center; border: 3px solid var(--secondary); border-radius: 15px; outline: none; margin: 20px 0; background: #FAFAFA; }
        
        .chinese { font-size: 1.5rem; margin-top: 5px; color: #546E7A; font-weight: bold; }

        .sentence-tag {
            display: inline-flex; align-items: center; gap: 8px;
            background: var(--sent-bg); color: var(--sent-text);
            padding: 10px 20px; border-radius: 25px; margin-top: 15px;
            font-size: 1.1rem; font-style: italic; cursor: pointer;
            transition: all 0.2s; border: 2px solid transparent;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            max-width: 100%; line-height: 1.4; text-align: left;
        }
        .sentence-tag:hover { background: var(--sent-hover); transform: translateY(-2px); }
        .sentence-tag:active { transform: scale(0.98); }
        .sentence-tag.playing { border-color: var(--secondary); background: #fff; box-shadow: 0 0 10px rgba(79, 195, 247, 0.5); }

        .hint-section { margin-top: 15px; min-height: 40px; display: flex; flex-direction: column; align-items: center; }
        .hint-btn {
            background: var(--hint-bg); color: var(--hint-text);
            border: none; padding: 5px 15px; border-radius: 20px;
            font-size: 0.9rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }
        .hint-btn:active { transform: translateY(2px); box-shadow: none; }
        .answer-reveal {
            margin-top: 5px; font-size: 1.5rem; font-weight: bold; 
            color: var(--error); letter-spacing: 2px; min-height: 30px;
        }

        .nav-controls { display: flex; justify-content: space-around; align-items: center; width: 100%; margin-top: auto; padding-top: 25px; }
        .action-btn { background: var(--accent); color: white; border: none; padding: 10px 24px; border-radius: 50px; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 0 #D84315; font-weight: bold; }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }
        .speak-btn { width: 60px; height: 60px; border-radius: 50%; font-size: 26px; background: var(--secondary); box-shadow: 0 5px 0 #0288D1; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; color: white; }
        .speak-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .feedback { font-size: 1.3rem; height: 30px; margin-bottom: 5px; font-weight: bold; }
        .progress-indicator { position: absolute; top: 15px; right: 20px; font-size: 0.9rem; color: #B0BEC5; font-weight: bold; }

        #settings-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; padding: 20px; border-radius: 15px; max-height: 85vh; overflow-y: auto; text-align: left; }
        textarea { width: 100%; height: 250px; border: 2px solid #eee; padding: 10px; font-family: monospace; font-size: 0.9rem; border-radius: 8px; resize: vertical; }
        .modal-actions { text-align: right; margin-top: 15px; display: flex; justify-content: flex-end; gap: 10px; }
        
        #emergency-reset { position: fixed; bottom: 10px; left: 10px; font-size: 12px; opacity: 0.7; z-index: 9999; text-decoration: underline; cursor: pointer; color: #d32f2f; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 4px; }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        @keyframes pop { 50% {transform: scale(1.2);} }
        .anim-shake { animation: shake 0.4s; color: var(--error); }
        .anim-pop { animation: pop 0.3s; color: var(--success); }
    </style>
</head>
<body>

<header class="noselect">
    <div style="width:30px"></div>
    <div class="header-title">ğŸ Spelling Bee V4.4</div>
    <button class="setting-btn" onclick="openSettings()">âš™ï¸</button>
</header>

<div class="controls-row noselect">
    <select id="levelSelect" onchange="changeLevel()"></select>
    <select id="voiceSelect" onchange="setVoice()"><option>Loading...</option></select>
</div>

<div class="tabs noselect">
    <button class="tab-btn active" onclick="switchMode('study')" id="tab-study">ğŸ‘€ å­¸ç¿’</button>
    <button class="tab-btn" onclick="switchMode('block')" id="tab-block">ğŸ§© æ‹¼åœ–</button>
    <button class="tab-btn" onclick="switchMode('dictation')" id="tab-dictation">âœï¸ è½å¯«</button>
</div>

<div id="game-area">
    <div style="padding:20px; color:#999;">Loading... <br>å¦‚æœé•·æ™‚é–“æœªé¡¯ç¤ºï¼Œè«‹æŒ‰å·¦ä¸‹è§’ç´…å­—é‡ç½®</div>
</div>

<div id="settings-modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--text)">ğŸ“ ç·¨è¼¯å–®å­—åº«</h3>
        <p style="font-size:0.9rem; color:#666; background:#f5f5f5; padding:8px; border-radius:5px;">æ ¼å¼ï¼šå–®å­—=éŸ³ç¯€=ä¸­æ–‡=ä¾‹å¥</p>
        <textarea id="data-input"></textarea>
        <div class="modal-actions">
            <button class="action-btn" style="background:#B0BEC5" onclick="closeSettings()">å–æ¶ˆ</button>
            <button class="action-btn" style="background:#FFB74D" onclick="resetDefault()">æ¢å¾©é è¨­</button>
            <button class="action-btn" style="background:var(--success)" onclick="saveData()">ğŸ’¾ å„²å­˜</button>
        </div>
    </div>
</div>

<div id="emergency-reset" onclick="hardReset()">âš ï¸ ç•«é¢å¡ä½ï¼Ÿé»æˆ‘é‡ç½®</div>

<script>
    // éŒ¯èª¤æ•æ‰
    window.onerror = function(msg, url, line) {
        console.error("Error:", msg);
        return false;
    };

    const defaultDataRaw = `
attach=at-tach=é™„ä¸Š=Please attach the file.
grunted=grunt-ed=å“¼è²=The pig grunted loudly.
lumber=lum-ber=æœ¨æ=We need more lumber.
screwdriver=screw-driv-er=èºçµ²èµ·å­=Hand me the screwdriver.
sneakers=sneak-ers=é‹å‹•é‹=I like your sneakers.
beneath=be-neath=åœ¨...ä¸‹=The cat is beneath the table.
laces=la-ces=é‹å¸¶=Tie your shoe laces.
perfectly=per-fect-ly=å®Œç¾åœ°=It fits perfectly.
shrunk=shrunk=ç¸®æ°´=My shirt shrunk.
splinters=splin-ters=ç¢ç‰‡=Watch out for splinters.
board=board=æ¿å­=Look at the board.
loosened=loos-ened=è®Šé¬†=The knot loosened.
travel=trav-el=æ—…è¡Œ=We love to travel.
alley=al-ley=å°å··=Do not go in the alley.
explore=ex-plore=æ¢ç´¢=Lets explore the woods.
pup=pup=å°ç‹—=The pup is cute.
collar=col-lar=é …åœˆ=The dog has a red collar.
furniture=fur-ni-ture=å®¶å…·=New furniture is nice.
racket=rack-et=çƒæ‹=I lost my racket.
crash=crash=æ’æ“Š=I heard a loud crash.
`;

    let allWords = [];
    let currentLevelWords = [];
    let currentIndex = 0;
    let currentMode = 'study';
    let currentVoice = null;
    let isSyllableShown = false;
    const synth = window.speechSynthesis;
    const STORAGE_KEY = 'spelling_bee_v4_4_final'; // æ›´æ–° Key

    // å¼·åˆ¶é‡ç½®
    window.hardReset = function() {
        if(confirm("ç¢ºå®šè¦å¼·åˆ¶é‡ç½®æ‰€æœ‰è¨­å®šå—ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    };

    // å•Ÿå‹•
    setTimeout(function() {
        try {
            loadData();
            initVoices();
        } catch(e) {
            console.error("Init error:", e);
            document.getElementById('game-area').innerHTML = '<p style="color:red">å•Ÿå‹•å¤±æ•—ï¼Œè«‹æŒ‰å·¦ä¸‹è§’é‡ç½®ã€‚</p>';
        }
    }, 100);

    function loadData() {
        let stored = localStorage.getItem(STORAGE_KEY);
        if (!stored || stored.trim() === '') stored = defaultDataRaw.trim();
        parseAndSetData(stored);
    }

    function parseAndSetData(text) {
        allWords = [];
        const lines = text.split('\n');
        lines.forEach(line => {
            if(line.trim() === '') return;
            const parts = line.split('=');
            if(parts.length >= 1) {
                const w = parts[0].trim();
                const s = parts[1] ? parts[1].split('-') : [w];
                const m = parts[2] || "";
                const sent = parts[3] || ""; 
                allWords.push({ w: w, s: s, m: m, sent: sent });
            }
        });
        initLevels();
        loadLevel(0);
    }

    function changeLevel() {
        const select = document.getElementById('levelSelect');
        loadLevel(select.value);
    }

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`tab-${mode}`).classList.add('active');
        isSyllableShown = false;
        renderGame();
    }

    function openSettings() {
        let stored = localStorage.getItem(STORAGE_KEY);
        document.getElementById('data-input').value = stored ? stored : defaultDataRaw.trim();
        document.getElementById('settings-modal').style.display = 'flex';
    }
    function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
    function saveData() {
        const val = document.getElementById('data-input').value.trim();
        if(!val) { alert("å…§å®¹ä¸èƒ½ç‚ºç©º"); return; }
        localStorage.setItem(STORAGE_KEY, val);
        parseAndSetData(val);
        alert("è¨­å®šå·²å„²å­˜ï¼");
        closeSettings();
    }
    function resetDefault() {
        if(confirm("ç¢ºå®šè¦æ¢å¾©æˆåŸå§‹è¨­å®šå—ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            parseAndSetData(defaultDataRaw.trim());
            document.getElementById('data-input').value = defaultDataRaw.trim();
            closeSettings();
        }
    }

    function initLevels() {
        const select = document.getElementById('levelSelect');
        select.innerHTML = '';
        if(allWords.length === 0) return;
        const totalLevels = Math.ceil(allWords.length / 10);
        for(let i=0; i<totalLevels; i++) {
            let opt = document.createElement('option'); opt.value = i;
            let end = Math.min((i+1)*10, allWords.length);
            opt.text = `Level ${i+1} (${i*10+1}-${end})`;
            select.appendChild(opt);
        }
        let allOpt = document.createElement('option'); allOpt.value = 'all'; allOpt.text = 'å…¨éƒ¨ All';
        select.appendChild(allOpt);
    }

    function loadLevel(val) {
        if(val === 'all') currentLevelWords = [...allWords];
        else {
            let start = parseInt(val) * 10;
            currentLevelWords = allWords.slice(start, start+10);
        }
        currentIndex = 0;
        isSyllableShown = false;
        renderGame();
    }

    // å®Œæ•´çš„ RenderGame å‡½å¼
    function renderGame() {
        const container = document.getElementById('game-area');
        const data = currentLevelWords[currentIndex];
        if(!data) { container.innerHTML = "ç„¡è³‡æ–™"; return; }

        let html = `<div class="progress-indicator">${currentIndex+1} / ${currentLevelWords.length}</div>`;

        let sentHtml = data.sent ? 
            `<div class="sentence-tag noselect" onclick="speakSentence(this)">
                <span class="sent-icon">ğŸ”Š</span>
                <span>${data.sent}</span>
            </div>` : '';

        let hintHtml = `
            <div class="hint-section noselect">
                <button class="hint-btn" onclick="toggleAnswer()">ğŸ’¡ å·çœ‹ç­”æ¡ˆ (Peek)</button>
                <div id="answer-reveal" class="answer-reveal"></div>
            </div>
        `;

        if (currentMode === 'study') {
            html += `<div class="feedback" id="feedback-msg"></div>`;
            html += `<div class="syllable-display" id="syl-display">${isSyllableShown ? data.s.join(' â€¢ ') : ''}</div>`;
            html += `<div class="big-word noselect" onclick="speakWord()">${colorCodeWord(data.w)}</div>`;
            html += `<div class="chinese">${data.m}</div>`;
            html += sentHtml;
            html += `<div class="nav-controls noselect">
                <button class="action-btn" onclick="toggleSyllable()" style="background:#90A4AE">æ‹†è§£</button>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <button class="action-btn" onclick="nextWord()">ä¸‹ä¸€å­— â¡</button>
            </div>`;
        } else if (currentMode === 'block') {
            html += `<div class="feedback" id="feedback-msg">é‡çµ„ç·´ç¿’</div>`;
            html += `<div class="chinese">${data.m}</div>`;
            html += `<div class="letter-slots" id="slots-area">`;
            for(let i=0; i<data.w.length; i++) html += data.w[i] === ' ' ? `<div class="slot space"> </div>` : `<div class="slot" id="slot-${i}"></div>`;
            html += `</div>`;
            html += `<div class="scramble-area noselect" id="block-btns"></div>`;
            html += hintHtml; 
            html += sentHtml;
            html += `<div class="nav-controls noselect">
                <button class="action-btn" style="background:#B0BEC5" onclick="renderGame()">é‡ç½® â†º</button>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <button class="action-btn" onclick="nextWord()">è·³é â¡</button>
            </div>`;
            setTimeout(() => initBlockGame(data.w), 0);
        } else if (currentMode === 'dictation') {
            html += `<div class="feedback" id="feedback-msg">è½å¯«ç·´ç¿’</div>`;
            html += `<div class="chinese">${data.m}</div>`;
            html += `<input type="text" class="input-box" id="dict-input" autocomplete="off" placeholder="Type answer..." onkeypress="handleEnter(event)">`;
            html += hintHtml; 
            html += sentHtml;
            html += `<div class="nav-controls noselect">
                <button class="action-btn" onclick="checkDictation()">æª¢æŸ¥ âœ…</button>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <button class="action-btn" onclick="nextWord()">è·³é â¡</button>
            </div>`;
        }
        container.innerHTML = html;
        if(currentMode !== 'study') setTimeout(speakWord, 600);
    }

    function colorCodeWord(w) { return w.split('').map(c => /[aeiou]/i.test(c) ? `<span class="vowel">${c}</span>` : (/[a-z]/i.test(c)?`<span class="consonant">${c}</span>`:c)).join(''); }
    function toggleSyllable() { isSyllableShown = !isSyllableShown; document.getElementById('syl-display').innerText = isSyllableShown ? currentLevelWords[currentIndex].s.join(' â€¢ ') : ''; }
    
    function toggleAnswer() {
        const el = document.getElementById('answer-reveal');
        if(!el) return;
        if(el.innerText === "") {
            el.innerText = currentLevelWords[currentIndex].w;
        } else {
            el.innerText = "";
        }
    }

    function nextWord() {
        if (currentIndex < currentLevelWords.length - 1) { currentIndex++; renderGame(); }
        else { if(confirm("å®Œæˆæœ¬çµ„ï¼é‡ä¾†ä¸€æ¬¡ï¼Ÿ")) { currentIndex=0; renderGame(); } }
    }
    
    function initVoices() {
        const s = document.getElementById('voiceSelect');
        function load() {
            let vs = synth.getVoices();
            if(vs.length===0) return;
            s.innerHTML = '';
            vs.forEach((v,i) => {
                let opt = document.createElement('option'); opt.value = i;
                opt.text = `${v.name.substring(0,20)} (${v.lang})`;
                s.appendChild(opt);
                if(v.lang==='en-US' && v.name.includes('Google')) s.selectedIndex = i;
            });
            currentVoice = vs[s.selectedIndex];
        }
        load();
        if(speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = load;
    }
    function setVoice() { currentVoice = synth.getVoices()[document.getElementById('voiceSelect').value]; }
    
    function speakWord() {
        try {
            synth.cancel();
            if(!currentVoice) initVoices();
            const u = new SpeechSynthesisUtterance(currentLevelWords[currentIndex].w);
            if(currentVoice) u.voice = currentVoice;
            u.rate = 0.85; 
            synth.speak(u);
        } catch(e) { console.error(e); }
    }

    function speakSentence(el) {
        try {
            synth.cancel();
            if(!currentVoice) initVoices();
            const sent = currentLevelWords[currentIndex].sent;
            const u = new SpeechSynthesisUtterance(sent);
            if(currentVoice) u.voice = currentVoice;
            u.rate = 0.9; 
            if(el) el.classList.add('playing');
            u.onend = () => { if(el) el.classList.remove('playing'); };
            synth.speak(u);
        } catch(e) { console.error(e); }
    }

    function initBlockGame(word) {
        let chars = word.split('').map((c,i)=>({c,i})).filter(x=>x.c!==' ');
        for(let i=chars.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [chars[i],chars[j]]=[chars[j],chars[i]]; }
        const area = document.getElementById('block-btns');
        chars.forEach(item => {
            let btn = document.createElement('button'); btn.className = 'block-btn noselect'; btn.innerText = item.c;
            btn.onclick = () => {
                let idx = -1;
                for(let k=0; k<word.length; k++) {
                    if(!document.getElementById(`slot-${k}`)?.innerText && word[k]!==' ') { idx=k; break; }
                }
                if(idx !== -1) {
                    let s = document.getElementById(`slot-${idx}`); 
                    s.innerText = item.c; 
                    s.classList.add('filled');
                    btn.disabled = true;
                    checkBlock(word);
                }
            };
            area.appendChild(btn);
        });
    }

    function checkBlock(target) {
        let cur = '';
        for(let i=0; i<target.length; i++) cur += target[i]===' '?' ':document.getElementById(`slot-${i}`).innerText;
        if(cur.length === target.length) {
            if(cur.toLowerCase()===target.toLowerCase()) feedback(true);
            else { feedback(false); setTimeout(renderGame, 1000); }
        }
    }
    
    function checkDictation() {
        const ans = document.getElementById('dict-input').value.trim().toLowerCase();
        const tgt = currentLevelWords[currentIndex].w.toLowerCase();
        if(ans===tgt) feedback(true); else feedback(false);
    }
    function handleEnter(e) { if(e.key==='Enter') checkDictation(); }

    function feedback(correct) {
        const m = document.getElementById('feedback-msg');
        const inp = document.getElementById('dict-input');
        if(correct) {
            m.innerHTML = "<span class='anim-pop' style='color:var(--success)'>Correct! ğŸ‰</span>";
            if(inp) { inp.style.borderColor = "var(--success)"; inp.style.background="#E8F5E9"; }
            safePlaySound(true); setTimeout(nextWord, 1200);
        } else {
            m.innerHTML = "<span class='anim-shake' style='color:var(--error)'>Try Again ğŸ˜…</span>";
            if(inp) { inp.classList.add('anim-shake'); inp.style.borderColor = "var(--error)"; inp.style.background="#FFEBEE"; setTimeout(()=>inp.classList.remove('anim-shake'),500); }
            safePlaySound(false);
        }
    }
    
    function safePlaySound(good) {
        try {
            const ctx = new (window.AudioContext||window.webkitAudioContext)();
            const o = ctx.createOscillator(); const g = ctx.createGain();
            o.connect(g); g.connect(ctx.destination);
            o.type = good?'sine':'triangle';
            o.frequency.setValueAtTime(good?600:150, ctx.currentTime);
            if(good) o.frequency.exponentialRampToValueAtTime(900, ctx.currentTime+0.1);
            else o.frequency.linearRampToValueAtTime(100, ctx.currentTime+0.2);
            g.gain.setValueAtTime(0.1, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+(good?0.5:0.3));
            o.start(); o.stop(ctx.currentTime+(good?0.5:0.3));
        } catch(e) {}
    }
</script>
</body>
</html>
