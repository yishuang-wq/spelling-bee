<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‹¼å­—å­¸ç¿’æ©Ÿ V5.0 (å­—æ ¹ç‰ˆ)</title>
    
    <style>
        :root {
            --primary: #FFD54F; --secondary: #4FC3F7; --accent: #FF7043; 
            --bg: #FFF9C4; --text: #37474F; --success: #66BB6A; --error: #EF5350;
            --sent-bg: #E0F7FA; --root-bg: #E8F5E9; --root-text: #2E7D32;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Comic Sans MS', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .noselect { -webkit-user-select: none; user-select: none; }

        header {
            width: 100%; background: var(--primary); padding: 10px 15px;
            text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header-title { font-size: 1.2rem; font-weight: bold; color: #5D4037; flex-grow: 1; }
        .setting-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }

        .controls-row { display: flex; justify-content: center; gap: 10px; width:100%; padding: 10px; background: #fff8e1;}
        select { padding: 8px; border-radius: 20px; border: 2px solid #ddd; font-size: 1rem; background: white; }

        .tabs { display: flex; width: 95%; max-width: 600px; margin: 10px auto; background: rgba(255,255,255,0.7); border-radius: 30px; padding: 5px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-weight: bold; font-size: 1rem; border-radius: 25px; color: #90A4AE; }
        .tab-btn.active { background: var(--secondary); color: white; box-shadow: 0 3px 6px rgba(3, 155, 229, 0.3); }

        #game-area {
            width: 95%; max-width: 600px; background: white; border-radius: 25px; padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08); text-align: center; margin-bottom: 20px;
            min-height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }

        .big-word { font-size: 3rem; font-weight: bold; margin: 15px 0; letter-spacing: 1px; cursor: pointer; }
        .big-word:active { transform: scale(0.95); }
        .syllable-display { font-size: 1.5rem; color: #90A4AE; margin-bottom: 5px; height: 30px; font-family: monospace; }
        
        .chinese { font-size: 1.5rem; margin-top: 5px; color: #546E7A; font-weight: bold; }

        /* ä¾‹å¥æ¨™ç±¤ */
        .sentence-tag {
            display: inline-flex; align-items: center; gap: 8px;
            background: var(--sent-bg); color: #006064;
            padding: 10px 20px; border-radius: 25px; margin-top: 10px;
            font-size: 1rem; font-style: italic; cursor: pointer;
            transition: all 0.2s; max-width: 100%; text-align: left;
        }
        .sentence-tag:active { transform: scale(0.98); background: #fff; }

        /* å­—æ ¹æ¨™ç±¤ (æ–°åŠŸèƒ½) */
        .root-tag {
            display: none; /* é è¨­éš±è— */
            background: var(--root-bg); color: var(--root-text);
            padding: 8px 15px; border-radius: 15px; margin-top: 8px;
            font-size: 0.95rem; border: 1px dashed var(--root-text);
        }
        .root-btn {
            background: none; border: none; color: var(--root-text);
            font-size: 0.9rem; cursor: pointer; text-decoration: underline; margin-top: 5px;
        }

        /* éŠæˆ²å…ƒç´  */
        .letter-slots { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; margin: 20px 0; min-height: 60px; }
        .slot { width: 40px; height: 45px; border-bottom: 4px solid #E0E0E0; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; }
        .slot.filled { border-bottom-color: var(--secondary); }
        .slot.space { border-bottom: none; width: 15px; }
        
        .scramble-area { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 10px; }
        .block-btn { width: 50px; height: 50px; background: var(--primary); border: none; border-radius: 12px; font-size: 1.6rem; font-weight: bold; box-shadow: 0 4px 0 #FFC107; cursor: pointer; }
        .block-btn:active { transform: translateY(4px); box-shadow: none; }
        .block-btn:disabled { opacity: 0; pointer-events: none; }
        
        .input-box { font-size: 1.8rem; padding: 10px; width: 90%; text-align: center; border: 3px solid var(--secondary); border-radius: 15px; outline: none; margin: 20px 0; background: #FAFAFA; }

        /* æ§åˆ¶å€ */
        .nav-controls { display: flex; justify-content: space-around; align-items: center; width: 100%; margin-top: auto; padding-top: 25px; }
        .action-btn { background: var(--accent); color: white; border: none; padding: 10px 24px; border-radius: 50px; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 0 #D84315; font-weight: bold; }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }
        .speak-btn { width: 60px; height: 60px; border-radius: 50%; font-size: 26px; background: var(--secondary); box-shadow: 0 5px 0 #0288D1; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; color: white; }
        .speak-btn:active { transform: translateY(4px); box-shadow: none; }

        .hint-section { margin-top: 15px; min-height: 40px; display: flex; flex-direction: column; align-items: center; }
        .hint-btn { background: #F3E5F5; color: #7B1FA2; border: none; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; cursor: pointer; box-shadow: 0 2px 0 rgba(0,0,0,0.1); }
        .hint-btn:active { transform: translateY(2px); box-shadow: none; }
        .answer-reveal { margin-top: 5px; font-size: 1.5rem; font-weight: bold; color: var(--error); letter-spacing: 2px; min-height: 30px; }

        /* è¨­å®šè¦–çª— */
        #settings-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; padding: 20px; border-radius: 15px; max-height: 85vh; overflow-y: auto; text-align: left; }
        textarea { width: 100%; height: 250px; border: 2px solid #eee; padding: 10px; font-family: monospace; font-size: 0.9rem; border-radius: 8px; resize: vertical; }
        .modal-actions { text-align: right; margin-top: 15px; display: flex; justify-content: flex-end; gap: 10px; }
        
        #emergency-reset { position: fixed; bottom: 10px; left: 10px; font-size: 12px; opacity: 0.7; z-index: 9999; text-decoration: underline; cursor: pointer; color: #d32f2f; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 4px; }
        
        .feedback { font-size: 1.3rem; height: 30px; margin-bottom: 5px; font-weight: bold; }
        .progress-indicator { position: absolute; top: 15px; right: 20px; font-size: 0.9rem; color: #B0BEC5; font-weight: bold; }
        
        /* è¦–è¦ºç‰¹æ•ˆ */
        .vowel { color: var(--vowel); } .consonant { color: var(--consonant); }
        @keyframes pop { 50% {transform: scale(1.2);} }
        .anim-pop { animation: pop 0.3s; color: var(--success); }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        .anim-shake { animation: shake 0.4s; color: var(--error); }
    </style>
</head>
<body>

<header class="noselect">
    <div style="width:30px"></div>
    <div class="header-title">ğŸ Spelling Bee V5.0</div>
    <button class="setting-btn" onclick="openSettings()">âš™ï¸</button>
</header>

<div class="controls-row noselect">
    <select id="levelSelect" onchange="changeLevel()"></select>
    <select id="voiceSelect" onchange="setVoice()"><option>Loading...</option></select>
</div>

<div class="tabs noselect">
    <button class="tab-btn active" onclick="switchMode('study')" id="tab-study">ğŸ‘€ å­¸ç¿’</button>
    <button class="tab-btn" onclick="switchMode('block')" id="tab-block">ğŸ§© æ‹¼åœ–</button>
    <button class="tab-btn" onclick="switchMode('dictation')" id="tab-dictation">âœï¸ è½å¯«</button>
</div>

<div id="game-area">
    <div style="padding:20px; color:#999;">Loading... <br>è‹¥å¡ä½è«‹æŒ‰å·¦ä¸‹è§’é‡ç½®</div>
</div>

<div id="settings-modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--text)">ğŸ“ ç·¨è¼¯å–®å­—åº«</h3>
        <p style="font-size:0.9rem; color:#666; background:#f5f5f5; padding:8px; border-radius:5px;">
            æ ¼å¼ï¼šå–®å­—=éŸ³ç¯€=ä¸­æ–‡=ä¾‹å¥=å­—æ ¹<br>
            (ä¾‹ï¼špredict=pre-dict=é æ¸¬=I predict rain.=pre(å‰)+dict(èªª))
        </p>
        <textarea id="data-input"></textarea>
        <div class="modal-actions">
            <button class="action-btn" style="background:#B0BEC5" onclick="closeSettings()">å–æ¶ˆ</button>
            <button class="action-btn" style="background:#FFB74D" onclick="resetDefault()">æ¢å¾©é è¨­</button>
            <button class="action-btn" style="background:var(--success)" onclick="saveData()">ğŸ’¾ å„²å­˜</button>
        </div>
    </div>
</div>

<div id="emergency-reset" onclick="hardReset()">âš ï¸ ç•«é¢å¡ä½ï¼Ÿé»æˆ‘é‡ç½®</div>

<script>
    // éŒ¯èª¤æ•æ‰
    window.onerror = function(msg) { console.error(msg); return false; };

    // é è¨­è³‡æ–™ (å«å­—æ ¹)
    const defaultDataRaw = `
predict=pre-dict=é æ¸¬=Scientists predict the weather.=pre(å‰) + dict(èªª) -> é å…ˆèªª
attract=at-tract=å¸å¼•=Flowers attract bees.=at(å») + tract(æ‹‰) -> æ‹‰éä¾†
bicycle=bi-cy-cle=è…³è¸è»Š=I ride my bicycle to school.=bi(äºŒ) + cycle(åœ“åœˆ) -> å…©è¼ªè»Š
exit=ex-it=å‡ºå£=Please use the emergency exit.=ex(å‘å¤–) + it(èµ°) -> èµ°å‡ºå»
return=re-turn=è¿”å›=Please return the book.=re(å›) + turn(è½‰) -> è½‰å›ä¾†
portable=por-ta-ble=å¯æ”œå¸¶çš„=This computer is portable.=port(æ‹¿) + able(å¯...çš„)
`;

    let allWords = [];
    let currentLevelWords = [];
    let currentIndex = 0;
    let currentMode = 'study';
    let currentVoice = null;
    let isSyllableShown = false;
    const synth = window.speechSynthesis;
    const STORAGE_KEY = 'spelling_bee_v5_root'; // æ–° Key

    // å¼·åˆ¶é‡ç½®
    window.hardReset = function() {
        if(confirm("ç¢ºå®šè¦é‡ç½®ï¼Ÿ")) { localStorage.removeItem(STORAGE_KEY); location.reload(); }
    };

    // å•Ÿå‹•
    setTimeout(function() {
        try { loadData(); initVoices(); } 
        catch(e) { console.error(e); document.getElementById('game-area').innerText='å•Ÿå‹•éŒ¯èª¤'; }
    }, 100);

    function loadData() {
        let stored = localStorage.getItem(STORAGE_KEY);
        if (!stored || stored.trim() === '') stored = defaultDataRaw.trim();
        parseAndSetData(stored);
    }

    function parseAndSetData(text) {
        allWords = [];
        const lines = text.split('\n');
        lines.forEach(line => {
            if(line.trim() === '') return;
            const parts = line.split('=');
            if(parts.length >= 1) {
                const w = parts[0].trim();
                const s = parts[1] ? parts[1].split('-') : [w];
                const m = parts[2] || "";
                const sent = parts[3] || ""; 
                const root = parts[4] || ""; // æ–°å¢å­—æ ¹æ¬„ä½
                allWords.push({ w: w, s: s, m: m, sent: sent, root: root });
            }
        });
        initLevels();
        loadLevel(0);
    }

    function changeLevel() { loadLevel(document.getElementById('levelSelect').value); }

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`tab-${mode}`).classList.add('active');
        isSyllableShown = false;
        renderGame();
    }

    function openSettings() {
        let stored = localStorage.getItem(STORAGE_KEY);
        document.getElementById('data-input').value = stored ? stored : defaultDataRaw.trim();
        document.getElementById('settings-modal').style.display = 'flex';
    }
    function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
    function saveData() {
        const val = document.getElementById('data-input').value.trim();
        if(!val) { alert("å…§å®¹ç‚ºç©º"); return; }
        localStorage.setItem(STORAGE_KEY, val);
        parseAndSetData(val);
        alert("å·²å„²å­˜");
        closeSettings();
    }
    function resetDefault() {
        if(confirm("æ¢å¾©é è¨­ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            parseAndSetData(defaultDataRaw.trim());
            document.getElementById('data-input').value = defaultDataRaw.trim();
            closeSettings();
        }
    }

    function initLevels() {
        const select = document.getElementById('levelSelect');
        select.innerHTML = '';
        if(allWords.length === 0) return;
        const totalLevels = Math.ceil(allWords.length / 10);
        for(let i=0; i<totalLevels; i++) {
            let opt = document.createElement('option'); opt.value = i;
            let end = Math.min((i+1)*10, allWords.length);
            opt.text = `Level ${i+1} (${i*10+1}-${end})`;
            select.appendChild(opt);
        }
        let allOpt = document.createElement('option'); allOpt.value = 'all'; allOpt.text = 'å…¨éƒ¨ All';
        select.appendChild(allOpt);
    }

    function loadLevel(val) {
        if(val === 'all') currentLevelWords = [...allWords];
        else {
            let start = parseInt(val) * 10;
            currentLevelWords = allWords.slice(start, start+10);
        }
        currentIndex = 0;
        isSyllableShown = false;
        renderGame();
    }

    // æ¸²æŸ“æ ¸å¿ƒ
    function renderGame() {
        const container = document.getElementById('game-area');
        const data = currentLevelWords[currentIndex];
        if(!data) { container.innerHTML = "ç„¡è³‡æ–™"; return; }

        let html = `<div class="progress-indicator">${currentIndex+1} / ${currentLevelWords.length}</div>`;

        // ä¾‹å¥å…ƒä»¶
        let sentHtml = data.sent ? 
            `<div class="sentence-tag noselect" onclick="speakSentence(this)">
                <span>ğŸ”Š ${data.sent}</span>
            </div>` : '';

        // å­—æ ¹å…ƒä»¶ (åªåœ¨å­¸ç¿’æ¨¡å¼é¡¯ç¤º)
        let rootHtml = '';
        if(currentMode === 'study' && data.root && data.root !== "ç„¡") {
            rootHtml = `
                <button class="root-btn" onclick="toggleRoot()">ğŸŒ± æŸ¥çœ‹å­—æ ¹ (Root)</button>
                <div id="root-display" class="root-tag">${data.root}</div>
            `;
        }

        // æç¤ºå…ƒä»¶
        let hintHtml = `
            <div class="hint-section noselect">
                <button class="hint-btn" onclick="toggleAnswer()">ğŸ’¡ å·çœ‹ç­”æ¡ˆ</button>
                <div id="answer-reveal" class="answer-reveal"></div>
            </div>
        `;

        if (currentMode === 'study') {
            html += `<div class="feedback" id="feedback-msg"></div>`;
            html += `<div class="syllable-display" id="syl-display">${isSyllableShown ? data.s.join(' â€¢ ') : ''}</div>`;
            html += `<div class="big-word noselect" onclick="speakWord()">${colorCodeWord(data.w)}</div>`;
            html += `<div class="chinese">${data.m}</div>`;
            html += rootHtml; // æ’å…¥å­—æ ¹
            html += sentHtml;
            html += `<div class="nav-controls noselect">
                <button class="action-btn" onclick="toggleSyllable()" style="background:#90A4AE">æ‹†è§£</button>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <button class="action-btn" onclick="nextWord()">ä¸‹ä¸€å­— â¡</button>
            </div>`;
        } else if (currentMode === 'block') {
            html += `<div class="feedback" id="feedback-msg">æ‹¼åœ–ç·´ç¿’</div>`;
            html += `<div class="chinese">${data.m}</div>`;
            html += `<div class="letter-slots" id="slots-area">`;
            for(let i=0; i<data.w.length; i++) html += data.w[i] === ' ' ? `<div class="slot space"> </div>` : `<div class="slot" id="slot-${i}"></div>`;
            html += `</div>`;
            html += `<div class="scramble-area noselect" id="block-btns"></div>`;
            html += hintHtml;
            html += sentHtml;
            html += `<div class="nav-controls noselect">
                <button class="action-btn" style="background:#B0BEC5" onclick="renderGame()">é‡ç½® â†º</button>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <button class="action-btn" onclick="nextWord()">è·³é â¡</button>
            </div>`;
            setTimeout(() => initBlockGame(data.w), 0);
        } else if (currentMode === 'dictation') {
            html += `<div class="feedback" id="feedback-msg">è½å¯«ç·´ç¿’</div>`;
            html += `<div class="chinese">${data.m}</div>`;
            html += `<input type="text" class="input-box" id="dict-input" autocomplete="off" placeholder="è¼¸å…¥ç­”æ¡ˆ" onkeypress="handleEnter(event)">`;
            html += hintHtml;
            html += sentHtml;
            html += `<div class="nav-controls noselect">
                <button class="action-btn" onclick="checkDictation()">æª¢æŸ¥ âœ…</button>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <button class="action-btn" onclick="nextWord()">è·³é â¡</button>
            </div>`;
        }
        container.innerHTML = html;
        if(currentMode !== 'study') setTimeout(speakWord, 600);
    }

    function colorCodeWord(w) { return w.split('').map(c => /[aeiou]/i.test(c) ? `<span class="vowel">${c}</span>` : (/[a-z]/i.test(c)?`<span class="consonant">${c}</span>`:c)).join(''); }
    function toggleSyllable() { isSyllableShown = !isSyllableShown; document.getElementById('syl-display').innerText = isSyllableShown ? currentLevelWords[currentIndex].s.join(' â€¢ ') : ''; }
    function toggleRoot() { 
        const el = document.getElementById('root-display'); 
        if(el) el.style.display = (el.style.display === 'block' ? 'none' : 'block'); 
    }
    function toggleAnswer() {
        const el = document.getElementById('answer-reveal');
        if(!el) return;
        el.innerText = (el.innerText === "") ? currentLevelWords[currentIndex].w : "";
    }
    function nextWord() {
        if (currentIndex < currentLevelWords.length - 1) { currentIndex++; renderGame(); }
        else { if(confirm("å®Œæˆæœ¬çµ„ï¼é‡ä¾†ï¼Ÿ")) { currentIndex=0; renderGame(); } }
    }
    
    function initVoices() {
        const s = document.getElementById('voiceSelect');
        function load() {
            let vs = synth.getVoices();
            if(vs.length===0) return;
            s.innerHTML = '';
            vs.forEach((v,i) => {
                let opt = document.createElement('option'); opt.value = i;
                opt.text = `${v.name.substring(0,20)} (${v.lang})`;
                s.appendChild(opt);
                if(v.lang==='en-US' && v.name.includes('Google')) s.selectedIndex = i;
            });
            currentVoice = vs[s.selectedIndex];
        }
        load();
        if(speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = load;
    }
    function setVoice() { currentVoice = synth.getVoices()[document.getElementById('voiceSelect').value]; }
    
    function speakWord() {
        try {
            synth.cancel(); if(!currentVoice) initVoices();
            const u = new SpeechSynthesisUtterance(currentLevelWords[currentIndex].w);
            if(currentVoice) u.voice = currentVoice; u.rate = 0.85; synth.speak(u);
        } catch(e) {}
    }
    function speakSentence(el) {
        try {
            synth.cancel(); if(!currentVoice) initVoices();
            const u = new SpeechSynthesisUtterance(currentLevelWords[currentIndex].sent);
            if(currentVoice) u.voice = currentVoice; u.rate = 0.9; 
            if(el) el.classList.add('playing');
            u.onend = () => { if(el) el.classList.remove('playing'); };
            synth.speak(u);
        } catch(e) {}
    }

    function initBlockGame(word) {
        let chars = word.split('').map((c,i)=>({c,i})).filter(x=>x.c!==' ');
        for(let i=chars.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [chars[i],chars[j]]=[chars[j],chars[i]]; }
        const area = document.getElementById('block-btns');
        chars.forEach(item => {
            let btn = document.createElement('button'); btn.className = 'block-btn noselect'; btn.innerText = item.c;
            btn.onclick = () => {
                let idx = -1;
                for(let k=0; k<word.length; k++) {
                    if(!document.getElementById(`slot-${k}`)?.innerText && word[k]!==' ') { idx=k; break; }
                }
                if(idx !== -1) {
                    let s = document.getElementById(`slot-${idx}`); s.innerText = item.c; s.classList.add('filled');
                    btn.disabled = true; checkBlock(word);
                }
            };
            area.appendChild(btn);
        });
    }

    function checkBlock(target) {
        let cur = '';
        for(let i=0; i<target.length; i++) cur += target[i]===' '?' ':document.getElementById(`slot-${i}`).innerText;
        if(cur.length === target.length) {
            if(cur.toLowerCase()===target.toLowerCase()) feedback(true);
            else { feedback(false); setTimeout(renderGame, 1000); }
        }
    }
    
    function checkDictation() {
        const ans = document.getElementById('dict-input').value.trim().toLowerCase();
        const tgt = currentLevelWords[currentIndex].w.toLowerCase();
        if(ans===tgt) feedback(true); else feedback(false);
    }
    function handleEnter(e) { if(e.key==='Enter') checkDictation(); }

    function feedback(correct) {
        const m = document.getElementById('feedback-msg');
        const inp = document.getElementById('dict-input');
        if(correct) {
            m.innerHTML = "<span class='anim-pop' style='color:var(--success)'>Correct! ğŸ‰</span>";
            if(inp) { inp.style.borderColor = "var(--success)"; inp.style.background="#E8F5E9"; }
            safePlaySound(true); setTimeout(nextWord, 1200);
        } else {
            m.innerHTML = "<span class='anim-shake' style='color:var(--error)'>Try Again ğŸ˜…</span>";
            if(inp) { inp.classList.add('anim-shake'); inp.style.borderColor = "var(--error)"; inp.style.background="#FFEBEE"; setTimeout(()=>inp.classList.remove('anim-shake'),500); }
            safePlaySound(false);
        }
    }
    
    function safePlaySound(good) {
        try {
            const ctx = new (window.AudioContext||window.webkitAudioContext)();
            const o = ctx.createOscillator(); const g = ctx.createGain();
            o.connect(g); g.connect(ctx.destination);
            o.type = good?'sine':'triangle';
            o.frequency.setValueAtTime(good?600:150, ctx.currentTime);
            if(good) o.frequency.exponentialRampToValueAtTime(900, ctx.currentTime+0.1);
            else o.frequency.linearRampToValueAtTime(100, ctx.currentTime+0.2);
            g.gain.setValueAtTime(0.1, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+(good?0.5:0.3));
            o.start(); o.stop(ctx.currentTime+(good?0.5:0.3));
        } catch(e) {}
    }
</script>
</body>
</html>
